â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ…¿ï¸  PARKED SESSION HANDOFF
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

**Session Date**: February 14, 2026  
**Duration**: ~2 hours  
**Primary Goal**: Implement housing XP cap progress bar â†’ Pivoted to chest ready indicator after investigation

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

## ğŸ“‹ Session Overview

This session started by exploring the "Housing XP Cap Progress Bar" enhancement (showing progress toward 2250 weekly XP cap). After extensive API investigation, we discovered the cap isn't directly exposed via WoW APIs and would require complex activity log parsing with "reward floor" calculations - too fragile for the value provided. We pivoted to implementing the "Endeavor Completion Alert" feature instead: a glowing chest icon that appears when the final milestone is complete but the chest hasn't been looted. This was successfully implemented as an experimental feature but cannot be tested until the next endeavor cycle in March 2026.

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

## âœ… Completed Work

### 1. Housing XP Cap Investigation
**Goal**: Determine if we can track weekly housing XP cap (2250 from activities + 250 from chest)

**Investigation Results**:
- Searched WoW API documentation for housing XP/favor tracking
- Found `C_Housing.GetCurrentHouseLevelFavor()` returns house level and total favor, but not weekly cap info
- Searched for currency tracking via `C_CurrencyInfo` - no obvious currency ID for housing XP cap
- Examined other addons' implementations - they use complex heuristics parsing activity logs with "reward floor" calculations per activity type
- **Conclusion**: No direct API available, would require fragile calculation-based approach

**Decision**: Deferred indefinitely - too complex for the value provided

**Important Context from Blue Post** (shared by user):
- Blizzard announced (Feb 14) they're adding UI improvements for Endeavors in a future update
- Quote: "The Endeavor user interface (UI) doesn't mention the XP cap or diminishing returns, but if you see House XP as a reward, you haven't yet hit the cap. UI improvements are coming in a future update."
- Smart to wait for Blizzard's implementation, then leverage their approach rather than building fragile heuristics

### 2. Chest Ready Indicator - Experimental Implementation
**Goal**: Alert player when endeavor is complete and chest reward is available but not claimed

**Files Modified**:
- **Header.lua** (lines 274-338): Added `UpdateChestIndicator()` function
- **Header.lua** (lines 8-45): Added chest indicator UI initialization (user moved from Core.lua)
- **Header.lua** (lines 122, 167): Added calls to check chest status during refresh

**Implementation Details**:

**Visual Component**:
- Glowing chest icon using `BonusLoot-Chest` atlas
- Positioned below frame title (user adjusted positioning)
- Pulse animation: alpha fades 1.0 â†’ 0.3 over 1 second, repeating
- Tooltip: "Endeavor Chest Ready! Visit your Housing Dashboard to claim your reward." + experimental disclaimer

**Logic** (`UpdateChestIndicator` function):
```lua
1. Check if initiative is active and has milestones
2. Get final milestone (the chest reward)
3. Check if final milestone is complete (currentProgress >= requiredContributionAmount)
4. Get chest quest ID from milestone rewards
5. Check if chest is ready to loot using C_QuestLog.ReadyForTurnIn(chestQuestID)
6. Show/hide indicator and start/stop animation based on result
```

**Defensive Coding**:
- Nil guards throughout (no pcall needed per user preference)
- Early returns if data unavailable
- Safe handling of `ReadyForTurnIn` returning nil

**Testing Status**: ğŸ§ª **Experimental**
- Cannot test until next endeavor cycle (March 2026)
- `IsQuestFlaggedCompleted` API proved unreliable during user testing (returns false even after looting on another character)
- `ReadyForTurnIn` is the expected correct API based on Blizzard's quest reward patterns
- May require adjustments once real behavior is observed

### 3. Documentation Updates
**Files Modified**:
- **.github/copilot-instructions.md** (lines 107-109):
  - Added Feb 14 work to Recent Work section
  - Updated Next steps to include chest indicator validation in March
  
- **.github/docs/development-status.md** (lines 11-21):
  - Added "Chest Ready Indicator - Experimental (Feb 14)" section
  - Documented implementation, testing status, and experimental nature
  
- **.github/docs/development-status.md** (lines 837-857):
  - Marked "Housing XP Cap Progress Bar" as **Deferred** with investigation details
  - Marked "Endeavor Completion Alert" as **Implemented ğŸ§ª** with experimental status
  - Added note about Blizzard's upcoming UI improvements

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

## ğŸ’¡ Key Insights & Decisions

### Why Housing XP Cap was Deferred

**Technical Challenge**:
- No direct WoW API exposes weekly housing XP cap or progress toward it
- Would require parsing `C_NeighborhoodInitiative.GetInitiativeActivityLogInfo()` and calculating "reward floors" based on activity types and diminishing returns
- Other addons use complex heuristics that are fragile and difficult to maintain

**Strategic Reason**:
- Blizzard announced (Feb 14 blue post) they're adding UI improvements for Endeavors
- Better to wait for their implementation, then leverage official APIs or reverse-engineer their updated FrameXML
- Avoids building technical debt that may become redundant or break with Blizzard's changes

**Blue Post Key Points**:
- XP cap increased from 1000 to 2250 (+ 250 from chest = 2500 total)
- Diminishing returns floor raised from 20% to 50% with weekly reset
- UI improvements coming in future update
- Current indicator: "if you see House XP as a reward, you haven't yet hit the cap"

### Chest Indicator API Decision

**Tested and Rejected**:
- `C_QuestLog.IsQuestFlaggedCompleted(questID)` - Returns false even after looting on another character
- `C_QuestLog.IsQuestFlaggedCompletedOnAccount(questID)` - Same issue

**Chosen Approach**:
- `C_QuestLog.ReadyForTurnIn(questID)` - Returns true when quest is available to turn in
- Aligns with Blizzard's quest reward UI patterns
- Untested but high confidence based on API documentation and usage patterns

**Risk Mitigation**:
- Implemented with defensive coding (nil guards, early returns)
- Hidden by default, only shows when all conditions met
- Marked as experimental in tooltip and documentation
- Can be adjusted in March once real-world behavior is observed

### Architectural Choice: Indicator in Header Module

User moved chest indicator initialization from Core.lua to Header.lua during session. This makes sense because:
- Keeps all header-related UI and logic together
- Header.lua already manages initiative display state
- Chest status is logically part of endeavor progress display
- Cleaner separation of concerns

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

## ğŸ“¦ Files Modified

### Modified

**Feature Implementation**:
- `Endeavoring/Features/Header.lua` - Added chest indicator UI and logic
  - Lines 8-45: Chest indicator initialization (icon, animation, tooltip)
  - Lines 122, 167: Added `UpdateChestIndicator()` calls during refresh
  - Lines 274-338: `UpdateChestIndicator()` function implementation

**Documentation**:
- `.github/copilot-instructions.md` - Updated Development Status section with Feb 14 work
- `.github/docs/development-status.md` - Added Feb 14 experimental feature entry, updated future enhancements status

### Created
- `.github/docs/park-20260214T1030.md` - This handoff document

### No Files Deleted

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

## ğŸ§ª Testing Status

### Chest Indicator
- âœ… Code review: Logic is sound based on Blizzard API patterns
- âœ… Nil safety: Defensive coding with guards throughout
- â¸ï¸ **In-game testing**: Cannot test until March 2026 when next endeavor starts
  - Need active endeavor with completable final milestone
  - Need to test both "chest ready" and "chest claimed" states
  - May need adjustments based on actual `ReadyForTurnIn` behavior

### API Investigation
- âœ… User tested `IsQuestFlaggedCompleted` - confirmed unreliable for this use case
- âœ… User tested `IsQuestFlaggedCompletedOnAccount` - same issue
- â¸ï¸ `ReadyForTurnIn` - untested, waiting for claimable chest

### Known Limitations
- Indicator will not show if chest is claimed on a different character (if `ReadyForTurnIn` is per-character)
- No feedback if the API call fails or returns unexpected values (just hides indicator)
- Animation plays indefinitely while chest is ready (no auto-dismiss after viewing)

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

## ğŸ¯ Recommended Next Steps

### Immediate (March 2026 - When Next Endeavor Starts)
1. **Validate chest indicator behavior**
   - Complete an endeavor to final milestone
   - Observe indicator appearance/timing
   - Test `ReadyForTurnIn` API behavior
   - Verify indicator hides after claiming chest
   - Test edge cases (logout/reload while chest ready, claiming on alt, etc.)

2. **Adjust indicator if needed**
   - If `ReadyForTurnIn` doesn't work as expected, investigate alternatives
   - Consider adding debug logging during March testing
   - May need fallback detection method

### Short-term (While Waiting for March)
3. **Implement auto-track tasks on progress** (Medium complexity)
   - Prototype already proven viable (Feb 12)
   - Use `tCompare` to detect task requirement changes
   - Auto-call `C_NeighborhoodInitiative.AddTrackedInitiativeTask()` when progress detected

4. **Task grouping/filtering by location** (Medium complexity)
   - Group tasks: "In the Neighborhood", "In the Related Zone", "End Game"
   - Help players find relevant tasks based on where they want to play

5. **Monitor Blizzard's UI improvements**
   - Watch for patches that add Endeavor UI improvements
   - When released, examine updated FrameXML in wow-ui-source
   - Check if new APIs expose housing XP cap information
   - Consider reimplementing XP cap feature if APIs are available

### Medium-term (Post v1.0.0)
6. **Personal Activity Log** - Per-character activity tracking and statistics
7. **Ace 3.0 Settings Migration** - Advanced settings UI with profile support
8. **Multi-neighborhood testing** - README notes this is untested, validate with multiple neighborhoods

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

## ğŸ“ Context to Preserve

### Why Simple Quest API Checks Work for Chest

The chest reward is implemented as a quest reward on the final milestone's `rewardQuestID`. Quest APIs like `ReadyForTurnIn` are reliable for detecting "this quest is available to complete right now" - much more straightforward than trying to reverse-engineer activity log reward calculations.

### Blizzard's Endeavor System Evolution

The Feb 14 blue post shows Blizzard is actively iterating on the Endeavor system:
- Increased XP caps (1000 â†’ 2250)
- Improved diminishing returns (20% â†’ 50% floor)
- Added weekly resets for diminishing returns
- Planning UI improvements

This rapid iteration means any complex tracking we implement may need frequent adjustments. Better to keep features simple and wait for Blizzard to stabilize the system.

### Housing XP vs House Favor Terminology

In the code and APIs, housing XP is called "favor" (e.g., `houseFavor`, `GetQuestLogRewardFavor`). The in-game UI calls it "House XP". Keep this in mind when searching APIs or reading Blizzard code.

### User's Testing Environment

User cannot test chest indicator because:
- Current endeavor already complete on main character
- Chest already looted
- Next endeavor cycle starts in March 2026

Testing on March will be the first opportunity to validate the implementation.

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

## ğŸš€ Quick Start for Next Session

**If resuming in March with chest testing:**
```
The chest ready indicator is implemented and ready to test. When the next endeavor starts in March:

1. Complete the endeavor to the final milestone (don't claim chest yet)
2. Check if the glowing chest icon appears below the "Endeavoring" frame title
3. Test that ReadyForTurnIn returns true for the chest quest ID
4. Claim the chest and verify indicator disappears
5. If behavior is incorrect, investigate alternative detection methods

Implementation is in Header.lua lines 8-45 (UI) and 274-338 (logic).
```

**If working on other features while waiting:**
```
Continue with auto-track tasks or task grouping features. Both are medium complexity and don't require waiting for March. See development-status.md "Future Enhancements" section for details. The auto-track prototype was validated Feb 12 using tCompare for deep task state comparison.
```

**If Blizzard ships UI improvements:**
```
Check wow-ui-source for updated FrameXML related to Endeavors. Look for:
- New APIs in C_NeighborhoodInitiative namespace
- Changes to HousingDashboard Endeavor tab implementation
- New fields in NeighborhoodInitiativeInfo structure
This may enable implementing the housing XP cap progress bar feature.
```

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
END OF HANDOFF
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
